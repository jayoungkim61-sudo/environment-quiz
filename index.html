<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™˜ê²½ í€´ì¦ˆ ê²Œì„ - í”Œë ˆì´ì–´</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- Firebase ì„¤ì • íŒŒì¼ (firebase-config.jsë§Œ ìˆ˜ì •í•˜ì„¸ìš”!) -->
    <script src="./firebase-config.js"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #root { width: 100%; max-width: 1200px; padding: 20px; }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        .title {
            text-align: center;
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 30px;
            font-weight: bold;
        }
        .login-form { max-width: 400px; margin: 0 auto; }
        .input-group { margin-bottom: 20px; }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .quiz-info { font-size: 18px; color: #333; }
        .timer {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
        }
        .question-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .question-number {
            color: #667eea;
            font-size: 18px;
            margin-bottom: 10px;
        }
        .question-text {
            font-size: 24px;
            color: #333;
            margin-bottom: 30px;
            font-weight: 500;
        }
        .answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .answer-btn {
            padding: 20px;
            font-size: 18px;
            border: 3px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        .answer-btn:hover:not(:disabled) { transform: scale(1.05); }
        .answer-btn:disabled { cursor: not-allowed; }
        .answer-0 { background: #e74c3c; color: white; }
        .answer-1 { background: #3498db; color: white; }
        .answer-2 { background: #f39c12; color: white; }
        .answer-3 { background: #2ecc71; color: white; }
        .answer-btn.selected { border-color: #333; }
        .answer-btn.correct {
            background: #27ae60 !important;
            border-color: #1e8449;
        }
        .answer-btn.incorrect {
            background: #95a5a6 !important;
            border-color: #7f8c8d;
        }
        .result-container { text-align: center; }
        .result-title {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 20px;
        }
        .user-score {
            font-size: 3em;
            color: #2ecc71;
            margin: 20px 0;
            font-weight: bold;
        }
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
        }
        .feedback.correct {
            background: #d4edda;
            color: #155724;
        }
        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
        }
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .rank-display {
            font-size: 1.5em;
            color: #e74c3c;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Firebase ì´ˆê¸°í™” (firebase-config.jsì—ì„œ ì„¤ì • ë¶ˆëŸ¬ì˜´)
        let database;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            database = firebase.database();
        } catch (error) {
            console.error("Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
        }

        const quizData = [
            { question: "ì§€êµ¬ ì˜¨ë‚œí™”ì˜ ì£¼ëœ ì›ì¸ì€ ë¬´ì—‡ì¸ê°€?", answers: ["ì‚°ì†Œ ì¦ê°€", "ì´ì‚°í™”íƒ„ì†Œ ë“± ì˜¨ì‹¤ê°€ìŠ¤ ì¦ê°€", "ì˜¤ì¡´ì¸µ íŒŒê´´", "í™©ì‚¬ ë°œìƒ"], correct: 1 },
            { question: "ì¬í™œìš© ë§ˆí¬ì—ì„œ ìˆ«ì 1ë²ˆì€ ì–´ë–¤ ì¬ì§ˆì„ ì˜ë¯¸í•˜ëŠ”ê°€?", answers: ["í´ë¦¬í”„ë¡œí•„ë Œ(PP)", "í´ë¦¬ìŠ¤í‹°ë Œ(PS)", "í´ë¦¬ì—í‹¸ë Œ í…Œë ˆí”„íƒˆë ˆì´íŠ¸(PET)", "í´ë¦¬ì—¼í™”ë¹„ë‹(PVC)"], correct: 2 },
            { question: "ë‹¤ìŒ ì¤‘ ì‹ ì¬ìƒ ì—ë„ˆì§€ê°€ ì•„ë‹Œ ê²ƒì€?", answers: ["íƒœì–‘ê´‘ ì—ë„ˆì§€", "í’ë ¥ ì—ë„ˆì§€", "ì„íƒ„ ì—ë„ˆì§€", "ì¡°ë ¥ ì—ë„ˆì§€"], correct: 2 },
            { question: "ì˜¤ì¡´ì¸µì´ íŒŒê´´ë˜ë©´ ì–´ë–¤ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ê°€?", answers: ["ì§€êµ¬ ì˜¨ë‚œí™”", "ì‚°ì„±ë¹„", "ìì™¸ì„  ì¦ê°€", "ë¯¸ì„¸ë¨¼ì§€ ì¦ê°€"], correct: 2 },
            { question: "ë¯¸ì„¸ë¨¼ì§€ì˜ ê¸°ì¤€ ì…ì í¬ê¸° PM2.5ëŠ” ì§€ë¦„ì´ ì–¼ë§ˆì¸ê°€?", answers: ["2.5mm", "2.5Î¼m(ë§ˆì´í¬ë¡œë¯¸í„°)", "2.5cm", "2.5nm"], correct: 1 },
            { question: "ìƒë¬¼ ë‹¤ì–‘ì„±ì´ ê°ì†Œí•˜ëŠ” ì£¼ëœ ì›ì¸ì€?", answers: ["ì„œì‹ì§€ íŒŒê´´", "ë‚ ì”¨ê°€ ì¢‹ì•„ì§", "ë™ë¬¼ ê°œì²´ìˆ˜ ì¦ê°€", "ì‹ë¬¼ ê´‘í•©ì„± ì¦ê°€"], correct: 0 },
            { question: "í”Œë¼ìŠ¤í‹±ì´ ìì—° ë¶„í•´ë˜ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì€ ì•½ ì–¼ë§ˆì¸ê°€?", answers: ["1ë…„", "10ë…„", "100ë…„", "500ë…„ ì´ìƒ"], correct: 3 },
            { question: "êµí†  ì˜ì •ì„œì˜ ì£¼ìš” ëª©ì ì€ ë¬´ì—‡ì¸ê°€?", answers: ["í•´ì–‘ ì˜¤ì—¼ ë°©ì§€", "ì˜¨ì‹¤ê°€ìŠ¤ ê°ì¶•", "ì‚°ë¦¼ ë³´í˜¸", "ë™ë¬¼ ë³´í˜¸"], correct: 1 },
            { question: "ë‹¤ìŒ ì¤‘ ì˜¨ì‹¤ê°€ìŠ¤ê°€ ì•„ë‹Œ ê²ƒì€?", answers: ["ì´ì‚°í™”íƒ„ì†Œ(CO2)", "ë©”íƒ„(CH4)", "ì•„ì‚°í™”ì§ˆì†Œ(N2O)", "ì‚°ì†Œ(O2)"], correct: 3 },
            { question: "ì¼íšŒìš©í’ˆ ì‚¬ìš©ì„ ì¤„ì´ëŠ” ê²ƒê³¼ ê°€ì¥ ê´€ë ¨ ìˆëŠ” í™˜ê²½ ìš´ë™ì€?", answers: ["ì œë¡œ ì›¨ì´ìŠ¤íŠ¸", "ê·¸ë¦°í”¼ìŠ¤", "ë ˆë“œë¦¬ìŠ¤íŠ¸", "ë¸”ë£¨ì˜¤ì…˜"], correct: 0 },
            { question: "ì‚°ì„±ë¹„ì˜ ì£¼ìš” ì›ì¸ ë¬¼ì§ˆì€?", answers: ["ì‚°ì†Œì™€ ìˆ˜ì†Œ", "ì´ì‚°í™”í™©ê³¼ ì§ˆì†Œì‚°í™”ë¬¼", "ì´ì‚°í™”íƒ„ì†Œì™€ ë©”íƒ„", "ì˜¤ì¡´ê³¼ í”„ë ˆì˜¨"], correct: 1 },
            { question: "ë‹¤ìŒ ì¤‘ ìƒë¶„í•´ í”Œë¼ìŠ¤í‹±ì˜ ì›ë£Œë¡œ ì‚¬ìš©ë˜ëŠ” ê²ƒì€?", answers: ["ì„ìœ ", "ì˜¥ìˆ˜ìˆ˜ ì „ë¶„", "ì² ê´‘ì„", "ì„íƒ„"], correct: 1 },
            { question: "ì§€êµ¬ì˜ í‰ê·  ê¸°ì˜¨ì´ ì‚°ì—…í™” ì´ì „ ëŒ€ë¹„ ëª‡ ë„ ì´ìƒ ìƒìŠ¹í•˜ì§€ ì•Šë„ë¡ ë…¸ë ¥í•´ì•¼ í•˜ëŠ”ê°€? (íŒŒë¦¬ ê¸°í›„í˜‘ì•½)", answers: ["0.5ë„", "1.5ë„", "3ë„", "5ë„"], correct: 1 },
            { question: "ë‹¤ìŒ ì¤‘ íƒ„ì†Œ ë°œìêµ­ì„ ì¤„ì´ëŠ” ë°©ë²•ì´ ì•„ë‹Œ ê²ƒì€?", answers: ["ëŒ€ì¤‘êµí†µ ì´ìš©", "ì—ì–´ì»¨ ì‚¬ìš© ì¦ê°€", "LED ì¡°ëª… ì‚¬ìš©", "ë¡œì»¬ í‘¸ë“œ ì†Œë¹„"], correct: 1 },
            { question: "ìŒì‹ë¬¼ ì“°ë ˆê¸°ë¥¼ í‡´ë¹„ë¡œ ë§Œë“œëŠ” ê³¼ì •ì„ ë¬´ì—‡ì´ë¼ê³  í•˜ëŠ”ê°€?", answers: ["ì†Œê°", "ë§¤ë¦½", "í‡´ë¹„í™”(ì»´í¬ìŠ¤íŒ…)", "ì¬í™œìš©"], correct: 2 },
            { question: "ìŠµì§€ì˜ í™˜ê²½ì  ì—­í• ì´ ì•„ë‹Œ ê²ƒì€?", answers: ["ìˆ˜ì§ˆ ì •í™”", "í™ìˆ˜ ì¡°ì ˆ", "ìƒë¬¼ ì„œì‹ì§€", "ì‚¬ë§‰í™” ì´‰ì§„"], correct: 3 },
            { question: "ì „ê¸° ìë™ì°¨ì˜ ì£¼ìš” ì¥ì ì€?", answers: ["ì˜¨ì‹¤ê°€ìŠ¤ ë°°ì¶œ ê°ì†Œ", "ì†ŒìŒ ì¦ê°€", "ì—°ë£Œë¹„ ì¦ê°€", "ìœ ì§€ë¹„ ì¦ê°€"], correct: 0 },
            { question: "ë‹¤ìŒ ì¤‘ ë©¸ì¢… ìœ„ê¸° ë™ë¬¼ì´ ì•„ë‹Œ ê²ƒì€?", answers: ["í˜¸ë‘ì´", "íŒë‹¤", "ì°¸ìƒˆ", "ë¶ê·¹ê³°"], correct: 2 },
            { question: "íƒœì–‘ê´‘ ë°œì „ì˜ ì¥ì ì€?", answers: ["í™”ì„ ì—°ë£Œ ì‚¬ìš©", "ì˜¨ì‹¤ê°€ìŠ¤ ë°°ì¶œ", "ë¬´í•œí•œ ì¬ìƒ ê°€ëŠ¥ ì—ë„ˆì§€", "ë†’ì€ í™˜ê²½ ì˜¤ì—¼"], correct: 2 },
            { question: "ë¬¼ ë¶€ì¡± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ê°œì¸ ì‹¤ì²œ ë°©ë²•ì€?", answers: ["ìƒ¤ì›Œ ì‹œê°„ ëŠ˜ë¦¬ê¸°", "ì–‘ì¹˜í•  ë•Œ ë¬¼ ê³„ì† í‹€ì–´ë†“ê¸°", "ì ˆìˆ˜ ê¸°ê¸° ì‚¬ìš©í•˜ê¸°", "ì„¸ì°¨ ìì£¼ í•˜ê¸°"], correct: 2 }
        ];

        function QuizGame() {
            const [stage, setStage] = useState('login');
            const [studentId, setStudentId] = useState('');
            const [studentName, setStudentName] = useState('');
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [score, setScore] = useState(0);
            const [correctAnswers, setCorrectAnswers] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showFeedback, setShowFeedback] = useState(false);
            const [timer, setTimer] = useState(20);
            const [startTime, setStartTime] = useState(null);
            const [playerId, setPlayerId] = useState(null);
            const [currentRank, setCurrentRank] = useState(null);
            const [error, setError] = useState(null);

            useEffect(() => {
                if (stage === 'quiz' && timer > 0 && !showFeedback) {
                    const interval = setInterval(() => {
                        setTimer(prev => prev - 1);
                    }, 1000);
                    return () => clearInterval(interval);
                } else if (timer === 0 && !showFeedback) {
                    handleAnswer(null);
                }
            }, [timer, stage, showFeedback]);

            useEffect(() => {
                if (playerId && database) {
                    const playersRef = database.ref('players');
                    playersRef.on('value', (snapshot) => {
                        const players = snapshot.val();
                        if (players) {
                            const playerArray = Object.entries(players).map(([id, data]) => ({ id, ...data }));
                            playerArray.sort((a, b) => {
                                if (b.score !== a.score) return b.score - a.score;
                                return a.timestamp - b.timestamp;
                            });
                            const rank = playerArray.findIndex(p => p.id === playerId) + 1;
                            setCurrentRank(rank);
                        }
                    });
                    return () => playersRef.off();
                }
            }, [playerId]);

            const handleLogin = async (e) => {
                e.preventDefault();
                if (studentId && studentName) {
                    try {
                        const newPlayerId = database.ref().child('players').push().key;
                        await database.ref('players/' + newPlayerId).set({
                            studentId, studentName, score: 0, correctAnswers: 0,
                            currentQuestion: 0, status: 'playing', timestamp: Date.now()
                        });
                        setPlayerId(newPlayerId);
                        setStage('quiz');
                        setStartTime(Date.now());
                    } catch (error) {
                        console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:", error);
                        setError("Firebase ì—°ê²° ì˜¤ë¥˜. firebase-config.js ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    }
                }
            };

            const updatePlayerData = async (updates) => {
                if (playerId && database) {
                    try {
                        await database.ref('players/' + playerId).update(updates);
                    } catch (error) {
                        console.error("ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", error);
                    }
                }
            };

            const handleAnswer = async (answerIndex) => {
                if (showFeedback) return;
                setSelectedAnswer(answerIndex);
                setShowFeedback(true);
                const isCorrect = answerIndex === quizData[currentQuestion].correct;
                const timeBonus = Math.max(0, timer) * 10;
                let newScore = score;
                let newCorrectAnswers = correctAnswers;
                if (isCorrect) {
                    newScore = score + 1000 + timeBonus;
                    newCorrectAnswers = correctAnswers + 1;
                    setScore(newScore);
                    setCorrectAnswers(newCorrectAnswers);
                }
                await updatePlayerData({ score: newScore, correctAnswers: newCorrectAnswers, currentQuestion: currentQuestion + 1 });
                setTimeout(() => {
                    if (currentQuestion < quizData.length - 1) {
                        setCurrentQuestion(prev => prev + 1);
                        setSelectedAnswer(null);
                        setShowFeedback(false);
                        setTimer(20);
                    } else {
                        finishQuiz(newScore, newCorrectAnswers);
                    }
                }, 2000);
            };

            const finishQuiz = async (finalScore, finalCorrectAnswers) => {
                const totalTime = Date.now() - startTime;
                await updatePlayerData({ score: finalScore, correctAnswers: finalCorrectAnswers, status: 'finished', totalTime });
                setStage('result');
            };

            if (error) {
                return (
                    <div className="container">
                        <h1 className="title">ğŸŒ í™˜ê²½ í€´ì¦ˆ ê²Œì„ ğŸŒ±</h1>
                        <div className="error-message">
                            <h3>âš ï¸ ì—°ê²° ì˜¤ë¥˜</h3>
                            <p>{error}</p>
                        </div>
                    </div>
                );
            }

            if (stage === 'login') {
                return (
                    <div className="container">
                        <h1 className="title">ğŸŒ í™˜ê²½ í€´ì¦ˆ ê²Œì„ ğŸŒ±</h1>
                        <form className="login-form" onSubmit={handleLogin}>
                            <div className="input-group">
                                <label>í•™ë²ˆ</label>
                                <input type="text" value={studentId} onChange={(e) => setStudentId(e.target.value)} placeholder="í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”" required />
                            </div>
                            <div className="input-group">
                                <label>ì´ë¦„</label>
                                <input type="text" value={studentName} onChange={(e) => setStudentName(e.target.value)} placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required />
                            </div>
                            <button type="submit" className="btn">ê²Œì„ ì‹œì‘</button>
                        </form>
                    </div>
                );
            }

            if (stage === 'quiz') {
                const question = quizData[currentQuestion];
                return (
                    <div className="container">
                        <div className="quiz-header">
                            <div className="quiz-info">
                                <strong>{studentName}</strong> ({studentId}) | ì ìˆ˜: {score}ì 
                                {currentRank && <span> | í˜„ì¬ ìˆœìœ„: <strong style={{color: '#e74c3c'}}>{currentRank}ìœ„</strong></span>}
                            </div>
                            <div className="timer">â±ï¸ {timer}ì´ˆ</div>
                        </div>
                        <div className="question-card">
                            <div className="question-number">ë¬¸ì œ {currentQuestion + 1} / {quizData.length}</div>
                            <div className="question-text">{question.question}</div>
                            <div className="answers-grid">
                                {question.answers.map((answer, index) => (
                                    <button key={index} className={`answer-btn answer-${index} ${selectedAnswer === index ? 'selected' : ''} ${showFeedback && index === question.correct ? 'correct' : ''} ${showFeedback && selectedAnswer === index && index !== question.correct ? 'incorrect' : ''}`} onClick={() => handleAnswer(index)} disabled={showFeedback}>
                                        {answer}
                                    </button>
                                ))}
                            </div>
                            {showFeedback && (
                                <div className={`feedback ${selectedAnswer === question.correct ? 'correct' : 'incorrect'}`}>
                                    {selectedAnswer === question.correct ? `âœ… ì •ë‹µì…ë‹ˆë‹¤! +${1000 + Math.max(0, timer) * 10}ì ` : `âŒ í‹€ë ¸ìŠµë‹ˆë‹¤. ì •ë‹µì€ "${question.answers[question.correct]}" ì…ë‹ˆë‹¤.`}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (stage === 'result') {
                return (
                    <div className="container">
                        <div className="result-container">
                            <h1 className="result-title">ğŸ‰ í€´ì¦ˆ ì™„ë£Œ! ğŸ‰</h1>
                            <div className="user-score">{score}ì </div>
                            <p style={{fontSize: '1.3em', color: '#333'}}>ì •ë‹µ: <strong>{correctAnswers}</strong> / {quizData.length}</p>
                            {currentRank && <div className="rank-display">ìµœì¢… ìˆœìœ„: <strong>{currentRank}ìœ„</strong></div>}
                            <p style={{marginTop: '20px', color: '#666'}}>í˜¸ìŠ¤íŠ¸ í™”ë©´ì—ì„œ ì „ì²´ ìˆœìœ„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
                        </div>
                    </div>
                );
            }
        }

        ReactDOM.render(<QuizGame />, document.getElementById('root'));
    </script>
</body>
</html>